<% content_for(:html_title) { 'activity_logs' } %>
<%=render "layouts/users_sidebar" %>
<div class = "mt-10 float-left w-full max-w-4xl content-center">
  <div class="rounded-3xl shadow-xl my-3 bg-indigo-500">
    <div class="flex justify-center -mt-8">
      <% if @registered.avatar.attached? %>
        <%= image_tag @registered.avatar.variant(:thumb), class: 'rounded-full border-solid border-white border-2 -mt-3'%>
      <% else %>
        <%=image_tag("#{ENV['DEFAULT_AVATAR_IMAGE_PATH']}", :height => '100', :width => '100', :alt => "user photo", class: 'rounded-full shadow-lg') %>
      <% end %>
    </div>
    <div class="text-center px-3 pb-6 pt-2">
      <h3 class="text-slate-200 text-sm bold font-sans"><%=h(@registered.full_name)%></h3>
    </div>
    <% if @address %>
      <hr>
      <%=link_to "https://www.google.com/maps/search/?api=1&query=#{@address.latitude},#{@address.longitude}", target: "_blank" do %>
        <%=image_tag("#{@address_map_image}", height: '300', width: '400')%>
      <% end %>
      <hr>
    <% end %>
    <div class="flex justify-center pb-3 text-slate-200">
      <div class="text-center">
        <h2><%=link_to 'View ' + @registered.posts.size.to_s + ' posts', user_posts_path(@registered.username)%> </h2>
      </div>
    </div>
  </div>
  <ol class="relative border-l border-gray-200 dark:border-gray-700">
    <% @activity.each do |activity_type|%>
      <% activity_type.each do |activity_item|%>
        <% if activity_item.class.name == 'Array'%>
          <% activity_item.each do |item| %>
            <% if item.class.name == 'Post'%>
              <li class="mb-4 ml-6">
                <span class="flex absolute -left-3 justify-center items-center w-6 h-6 bg-blue-200 rounded-full ring-8 ring-white dark:ring-gray-900 dark:bg-blue-900">
                  <% if item.user.avatar.attached? %>
                    <%= image_tag item.user.avatar.variant(:thumb), class: 'rounded-full shadow-lg'%>
                  <% else %>
                    <%=image_tag("/images/users/profile_picture.jpg", :alt => "user photo", class: 'rounded-full shadow-lg') %>
                  <% end %>
                </span>
                <div class = "bg-white rounded-lg border border-gray-200 shadow-sm dark:bg-gray-700 dark:border-gray-600">
                  <div class="justify-between items-center p-4 sm:flex">
                    <time class="mb-1 text-xs font-normal text-gray-400 sm:order-last sm:mb-0"><%= time_ago_in_words(item.created_at).to_s + " ago" %></time>
                    <div class="text-sm font-normal text-gray-500 lex dark:text-gray-300"><%=h(item.user.username)%> has created new post <a target = "_blank" href="<%=show_post_path(item.user.username, item.hashid)%>" class="font-semibold text-blue-600 dark:text-blue-500 hover:underline"><%="#{item.text[0,12]}..."%></a> </div>
                  </div>
                  <%=render 'posts/post', post: item  %>
                </div>
              </li>
            <% elsif item.class.name == 'Comment'%>
              <li class="mb-10 ml-6">
                <span class="flex absolute -left-3 justify-center items-center w-6 h-6 bg-blue-200 rounded-full ring-8 ring-white dark:ring-gray-900 dark:bg-blue-900">
                  <% if item.user.avatar.attached? %>
                    <%= image_tag item.user.avatar.variant(:thumb), class: 'rounded-full shadow-lg'%>
                  <% else %>
                    <%=image_tag("#{ENV['DEFAULT_AVATAR_IMAGE_PATH']}", :alt => "user photo", class: 'rounded-full shadow-lg') %>
                  <% end %>
                </span>
                <div class="p-4 bg-white rounded-lg border border-gray-200 shadow-sm dark:bg-gray-700 dark:border-gray-600">
                  <div class="justify-between items-center mb-3 sm:flex">
                    <time class="mb-1 text-xs font-normal text-gray-400 sm:order-last sm:mb-0"><%= time_ago_in_words(item.created_at).to_s + " ago" %></time>
                    <div class="text-sm font-normal text-gray-500 lex dark:text-gray-300"><%=h(item.user.username)%> has commented on <a target = "_blank" href="<%=show_post_path(item.user.username, item.post.hashid)%>" class="font-semibold text-blue-600 dark:text-blue-500 hover:underline"><%=item.post.text[0,12]%></a></div>
                  </div>
                  <div class="p-3 text-sm font-normal text-gray-500 bg-gray-50 rounded-lg border border-gray-200 dark:bg-gray-600 dark:border-gray-500 dark:text-gray-300">
                    <%=render 'layouts/comment_body', {comment: item}  %>
                  </div>
                </div>
              </li>
            <% else %>
              <li class="mb-10 ml-6">
                <span class="flex absolute -left-3 justify-center items-center w-6 h-6 bg-blue-200 rounded-full ring-8 ring-white dark:ring-gray-900 dark:bg-blue-900">
                  <% if item.user.avatar.attached? %>
                    <%= image_tag item.user.avatar.variant(:thumb), class: 'rounded-full shadow-lg'%>
                  <% else %>
                    <%=image_tag("/images/users/profile_picture.jpg", :alt => "user photo", class: 'rounded-full shadow-lg') %>
                  <% end %>
                </span>
                <div class="p-4 bg-white rounded-lg border border-gray-200 shadow-sm dark:bg-gray-700 dark:border-gray-600">
                  <div class="justify-between items-center mb-3 sm:flex">
                    <time class="mb-1 text-xs font-normal text-gray-400 sm:order-last sm:mb-0"><%= time_ago_in_words(item.created_at).to_s + " ago" %></time>
                    <div class="text-sm font-normal text-gray-500 lex dark:text-gray-300">
                      <%=h(item.user.username)%> has 
                      👍🏼
                      <%=item.comment.nil? ? "post" : "comment" %> on <a target = "_blank" href="<%=item.comment.nil? ? show_post_url(item.post.user.username, item.post.hashid) : show_post_url(item.comment.post.user.username, item.comment.post.hashid) %>" class="font-semibold text-blue-600 dark:text-blue-500 hover:underline"><%=item.comment.nil? ? item.post.text[0,12] : item.comment.post.text[0,12] %></a></div>
                  </div>
                  <div class="p-3 text-sm font-normal text-gray-500 bg-gray-50 rounded-lg border border-gray-200 dark:bg-gray-600 dark:border-gray-500 dark:text-gray-300">
                    <%=item.comment.nil? ? item.post.text[0,12] : item.comment.body%>
                  </div>
                </div>
              </li>
            <% end %>
          <% end %>
        <% else %>
          <li class="text-xl mb-6 text-center bold"><%=activity_item%></li>
        <% end %>
      <% end %>
    <% end %>
    <li class="text-xl mb-6 text-center bold"><%=@registered.created_at.strftime("%b %d, %Y")%> </li>
    <li class="mb-10 ml-6">
      <span class="flex absolute -left-3 justify-center items-center w-6 h-6 bg-blue-200 rounded-full ring-8 ring-white dark:ring-gray-900 dark:bg-blue-900">
        <% if @registered.avatar.attached? %>
          <%= image_tag @registered.avatar.variant(:thumb), class: 'rounded-full shadow-lg'%>
        <% else %>
          <%=image_tag("#{ENV['DEFAULT_AVATAR_IMAGE_PATH']}", :alt => "user photo", class: 'rounded-full shadow-lg') %>
        <% end %>
      </span>
      <div class="justify-between items-center p-4 bg-white rounded-lg border border-gray-200 shadow-sm sm:flex dark:bg-gray-700 dark:border-gray-600">
        <time class="mb-1 text-xs font-normal text-gray-400 sm:order-last sm:mb-0"><%= time_ago_in_words(@registered.created_at).to_s + " ago" %></time>
        <div class="text-sm font-normal text-gray-500 lex dark:text-gray-300"><%=h(@registered.username)%> <%=t('registered')%>  </div>
      </div>
    </li>
  </ol>
</div>
